<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upload Your Skin Image - DermaStreak</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    function previewImage(event) {
      const reader = new FileReader();
      reader.onload = function () {
        const output = document.getElementById("preview");
        output.src = reader.result;
        output.classList.remove("hidden");
      };
      reader.readAsDataURL(event.target.files[0]);
    }
  </script>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-6">
  <!-- AI Streak Display -->
<div id="ai-streak-container" style="position: fixed; top: 10px; right: 10px; background: linear-gradient(to right, #7AD7F0, #4CAF50); color: white; padding: 12px 24px; border-radius: 50px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); font-size: 16px; font-weight: bold; z-index: 999;">
  üî• AI Streak: <span id="streak-count">0</span> days
</div>
<!-- Image Upload Section -->
<div style="margin-top: 100px; text-align: center;">
  <input type="file" id="imageInput" accept="image/*" style="margin-bottom: 10px;">
  <div id="previewContainer" style="display:none;">
    <img id="previewImage" src="" style="max-width: 200px; max-height: 200px; border-radius: 12px; margin-top: 10px;" />
    <br>
    <button onclick="removeImage()" style="margin-top: 10px; padding: 8px 16px; border: none; background-color: #e74c3c; color: white; border-radius: 8px;">‚ùå Remove</button>
  </div>
</div>

  <div class="bg-white rounded-2xl shadow-xl p-8 max-w-lg w-full space-y-6">
    <h2 class="text-3xl font-bold text-center text-green-600">Upload Your Skin Image</h2>
    <p class="text-center text-gray-500">Track your skincare journey by uploading today's image.</p>

    <form action="/upload" method="POST" enctype="multipart/form-data" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Select Image</label>
        <input
          type="file"
          name="skinImage"
          accept="image/*"
          onchange="previewImage(event)"            
          required
          class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500"
        />
      </div>

      <div class="flex justify-center">
        <img id="preview" class="hidden mt-4 max-h-64 rounded-lg shadow-md" alt="Preview" />
      </div>

      <button
        type="submit"
        class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg transition duration-200"
      >
        Upload Image
      </button>
    </form>
  </div>
  <script>
  let streak = parseInt(localStorage.getItem("aiStreak")) || 0;
  let lastUploaded = localStorage.getItem("lastUpload");

  document.getElementById("streak-count").textContent = streak;

  const imageInput = document.getElementById("imageInput");
  const previewContainer = document.getElementById("previewContainer");
  const previewImage = document.getElementById("previewImage");

  imageInput.addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const today = new Date().toISOString().split("T")[0];

    // Only increase streak if lastUpload was on a different day
    if (lastUploaded !== today) {
      streak++;
      localStorage.setItem("aiStreak", streak);
      localStorage.setItem("lastUpload", today);
      document.getElementById("streak-count").textContent = streak;
    }

    const reader = new FileReader();
    reader.onload = function (e) {
      previewImage.src = e.target.result;
      previewContainer.style.display = "block";
    };
    reader.readAsDataURL(file);
  });

  function removeImage() {
    previewImage.src = "";
    previewContainer.style.display = "none";
    imageInput.value = "";

    // Revert streak if user removes today's upload
    const today = new Date().toISOString().split("T")[0];
    if (lastUploaded === today) {
      streak = Math.max(0, streak - 1);
      localStorage.setItem("aiStreak", streak);
      localStorage.removeItem("lastUpload");
      document.getElementById("streak-count").textContent = streak;
    }
  }
</script>

</body>
</html>
